#-*- coding: UTF-8 -*-

event_memoryaccess=0

def doublefetchanalyzer(eventlist):#检查doublefetch漏洞
    userspaceset=set()
    flag=True
    for event in eventlist:
        linenumber,eventnumber,details=event
        if eventnumber != event_memoryaccess:#是否为内存访问类型的事件
            continue
        isuserspaceaddress,addresslist=details
        if not isuserspaceaddress:#检查访问的内存是否位于用户地址空间中
            continue
        for address in addresslist:#对于addresslist中的每个地址，检查是否出现在已访问过的列表中
            if address not in userspaceset:
                userspaceset.add(address)
            else:
                flag=False
                print("[Warning] DoubleFetch found here!")
                print("Line Number =",linenumber)
    if flag:
        print("No DoubleFetch Vulnerability Found")
        
def unprobeanalyzer(eventlist):
    #todo
    pass